<!DOCTYPE html>

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BubbleChat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
        transition: background 0.8s ease;
    }

    /* ThÃ¨mes d'arriÃ¨re-plan */
    body.theme-zen {
        background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 50%, #80deea 100%);
    }

    body.theme-plage {
        background: linear-gradient(135deg, #ffd89b 0%, #f4a460 50%, #19547b 100%);
    }

    body.theme-foret {
        background: linear-gradient(135deg, #134e5e 0%, #3a7e6f 50%, #71b280 100%);
    }

    body.theme-futuriste {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    body.theme-bonbon {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ff9a9e 100%);
    }

    body.theme-bar {
        background: linear-gradient(135deg, #2c003e 0%, #4b0082 50%, #8b008b 100%);
    }

    body.theme-chasse {
        background: linear-gradient(135deg, #3e2723 0%, #5d4037 50%, #795548 100%);
    }

    body.theme-aquarium {
        background: linear-gradient(135deg, #00416a 0%, #1976d2 33%, #4caf50 66%, #ffe000 100%);
    }

    /* Pour image personnalisÃ©e */
    body.custom-bg {
        background-size: cover !important;
        background-position: center !important;
        background-attachment: fixed !important;
    }

    /* Particules */
    .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
    }

    .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        animation: float 20s infinite ease-in-out;
    }

    @keyframes float {
        0%, 100% {
            transform: translateY(0) translateX(0);
            opacity: 0;
        }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% {
            transform: translateY(-100vh) translateX(50px);
            opacity: 0;
        }
    }

    /* Conteneur principal */
    .chat-container {
        position: relative;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
        z-index: 1;
    }

    /* Header */
    .chat-header {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(30px);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .chat-title {
        font-size: 28px;
        font-weight: bold;
        color: white;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    /* SÃ©lecteur de thÃ¨mes */
    .theme-selector {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }

    .theme-label {
        color: white;
        font-weight: 600;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .theme-options {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
    }

    .theme-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 3px solid rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .theme-btn:hover {
        transform: scale(1.15);
        border-color: white;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }

    .theme-btn.active {
        border-color: white;
        box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.3);
    }

    .theme-btn-custom {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 3px solid rgba(255, 255, 255, 0.5);
        background: linear-gradient(135deg, #ffffff 0%, #cccccc 100%);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        transition: all 0.3s ease;
        position: relative;
    }

    .theme-btn-custom:hover {
        transform: scale(1.15);
        border-color: white;
    }

    .theme-btn-custom input[type="file"] {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    /* PHOTO DE PROFIL UTILISATEUR */
    .user-profile-photo {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 3px solid rgba(255, 255, 255, 0.6);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #ff6b9d 0%, #c06fff 100%);
        font-size: 20px;
        color: white;
        box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .user-profile-photo:hover {
        transform: scale(1.15);
        box-shadow: 0 6px 25px rgba(255, 107, 157, 0.6);
        border-color: white;
    }

    .user-profile-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Messages */
    .messages-area {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(30px);
        border-radius: 20px;
        padding: 20px;
        height: 500px;
        overflow-y: auto;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .message {
        background: rgba(255, 255, 255, 0.08);
        padding: 12px 18px;
        border-radius: 15px;
        margin-bottom: 12px;
        color: white;
        animation: slideIn 0.3s ease;
        display: flex;
        gap: 12px;
        align-items: flex-start;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* PHOTO DANS MESSAGE */
    .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        overflow: hidden;
        flex-shrink: 0;
        background: linear-gradient(135deg, #ff6b9d 0%, #c06fff 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .message-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .message-content {
        flex: 1;
    }

    .message-author {
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 14px;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .message-text {
        font-size: 16px;
    }

    .message-time {
        font-size: 11px;
        opacity: 0.7;
        text-align: right;
        margin-top: 5px;
    }

    /* Input */
    .input-area {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(30px);
        border-radius: 20px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        gap: 10px;
    }

    .message-input {
        flex: 1;
        padding: 15px 20px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        color: white;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    .message-input:focus {
        outline: none;
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
    }

    .message-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }

    .send-btn {
        padding: 15px 35px;
        background: linear-gradient(135deg, #ff6b9d 0%, #c06fff 100%);
        border: none;
        border-radius: 15px;
        color: white;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(192, 111, 255, 0.4);
    }

    .send-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(192, 111, 255, 0.6);
    }

    .attach-btn {
        padding: 10px;
        width: 45px;
        height: 45px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .attach-btn:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-2px);
    }

    /* Bouton Visio flottant */
    .floating-visio-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #ff6b9d 0%, #c06fff 100%);
        border-radius: 50%;
        border: none;
        cursor: pointer;
        box-shadow: 0 10px 40px rgba(192, 111, 255, 0.5);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        transition: all 0.3s ease;
        animation: pulse 2s infinite;
    }

    .floating-visio-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 15px 60px rgba(192, 111, 255, 0.7);
    }

    @keyframes pulse {
        0%, 100% {
            box-shadow: 0 10px 40px rgba(192, 111, 255, 0.5);
        }
        50% {
            box-shadow: 0 15px 60px rgba(192, 111, 255, 0.8);
        }
    }

    /* Modal Visio */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s ease;
    }

    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .modal {
        position: relative;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
        backdrop-filter: blur(30px);
        border: 2px solid rgba(255, 255, 255, 0.08);
        border-radius: 30px;
        padding: 40px;
        width: 90%;
        max-width: 900px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 25px 100px rgba(0, 0, 0, 0.5);
        transform: scale(0.7) rotateX(45deg);
        opacity: 0;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .modal-overlay.active .modal {
        transform: scale(1) rotateX(0deg);
        opacity: 1;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.08);
    }

    .header-controls {
        display: flex;
        gap: 10px;
    }

    .modal-title {
        font-size: 32px;
        font-weight: bold;
        color: white;
        text-shadow: 0 0 20px rgba(255, 107, 157, 0.8);
    }

    .minimize-btn {
        background: linear-gradient(135deg, #ffa502 0%, #ff6348 100%);
        border: none;
        color: white;
        font-size: 24px;
        font-weight: bold;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(255, 165, 2, 0.4);
    }

    .minimize-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 30px rgba(255, 165, 2, 0.6);
    }

    .close-btn {
        background: linear-gradient(135deg, #ff6b9d 0%, #c06fff 100%);
        border: none;
        color: white;
        font-size: 28px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(192, 111, 255, 0.4);
    }

    .close-btn:hover {
        transform: rotate(90deg) scale(1.1);
        box-shadow: 0 8px 30px rgba(192, 111, 255, 0.6);
    }

    .modal-content {
        color: white;
    }

    .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 20px;
        margin-bottom: 30px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.08);
    }

    .video-placeholder {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .video-placeholder-icon {
        font-size: 80px;
        margin-bottom: 20px;
        opacity: 0.7;
    }

    .video-placeholder-text {
        font-size: 18px;
        opacity: 0.8;
    }

    .participants-section {
        margin-bottom: 25px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section-title {
        font-size: 18px;
        font-weight: 600;
        color: white;
        margin-bottom: 15px;
    }

    .participants-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 15px;
        max-height: 200px;
        overflow-y: auto;
    }

    .participant-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        transition: all 0.3s ease;
    }

    .participant-item:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateX(5px);
    }

    .participant-item.active {
        border: 2px solid rgba(255, 107, 157, 0.5);
    }

    .participant-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #ff6b9d 0%, #c06fff 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        overflow: hidden;
    }

    .participant-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .participant-name {
        flex: 1;
        font-weight: 600;
        color: white;
    }

    .participant-status {
        font-size: 12px;
        padding: 4px 10px;
        background: rgba(46, 213, 115, 0.3);
        color: #2ed573;
        border-radius: 20px;
        border: 1px solid rgba(46, 213, 115, 0.5);
    }

    .invite-section {
        display: flex;
        gap: 10px;
    }

    .invite-input {
        flex: 1;
        padding: 12px 18px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        color: white;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .invite-input:focus {
        outline: none;
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 107, 157, 0.5);
    }

    .invite-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }

    .invite-btn {
        padding: 12px 25px;
        background: linear-gradient(135deg, #2ed573 0%, #26de81 100%);
        border: none;
        border-radius: 10px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(46, 213, 115, 0.3);
    }

    .invite-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(46, 213, 115, 0.5);
    }

    .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px;
    }

    .control-btn {
        padding: 15px 30px;
        font-size: 16px;
        font-weight: 600;
        color: white;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.1) 100%);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .control-btn:hover {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.08) 100%);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .control-btn.active {
        background: linear-gradient(135deg, #ff6b9d 0%, #c06fff 100%);
        border-color: rgba(255, 255, 255, 0.5);
    }

    /* Mode minimisÃ© */
    .modal.minimized {
        position: fixed;
        bottom: 120px;
        right: 30px;
        width: 320px;
        max-width: 320px;
        height: 220px;
        max-height: 220px;
        padding: 0;
        margin: 0;
        z-index: 10000;
        transform: scale(1) rotateX(0deg) !important;
        opacity: 1;
        border-radius: 20px;
        box-shadow: 0 15px 60px rgba(0, 0, 0, 0.8);
        overflow: hidden;
        cursor: move;
    }

    .modal.minimized .modal-header {
        margin-bottom: 0;
        padding: 12px 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        background: linear-gradient(135deg, rgba(255, 107, 157, 0.3) 0%, rgba(192, 111, 255, 0.3) 100%);
    }

    .modal.minimized .modal-title {
        font-size: 16px;
    }

    .modal.minimized .minimize-btn,
    .modal.minimized .close-btn {
        width: 35px;
        height: 35px;
        font-size: 20px;
    }

    .modal.minimized .modal-content {
        display: none;
    }

    .modal.minimized .mini-video-view {
        display: flex;
    }

    .modal-overlay.minimized {
        background: transparent;
        backdrop-filter: none;
        pointer-events: none;
    }

    .modal-overlay.minimized .modal {
        pointer-events: all;
    }

    .mini-video-view {
        display: none;
        flex-direction: column;
        gap: 10px;
        padding: 15px;
        height: calc(100% - 60px);
    }

    .mini-video-container {
        flex: 1;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .mini-video-icon {
        font-size: 40px;
        opacity: 0.7;
    }

    .mini-controls {
        display: flex;
        justify-content: center;
        gap: 8px;
    }

    .mini-control-btn {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .mini-control-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
    }

    .mini-control-btn.active {
        background: linear-gradient(135deg, #2ed573 0%, #26de81 100%);
    }

    .mini-control-btn.hangup {
        background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
    }

    /* Scrollbar */
    .messages-area::-webkit-scrollbar,
    .modal::-webkit-scrollbar,
    .participants-list::-webkit-scrollbar {
        width: 8px;
    }

    .messages-area::-webkit-scrollbar-track,
    .modal::-webkit-scrollbar-track,
    .participants-list::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
    }

    .messages-area::-webkit-scrollbar-thumb,
    .modal::-webkit-scrollbar-thumb,
    .participants-list::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #ff6b9d 0%, #c06fff 100%);
        border-radius: 10px;
    }

    /* ===== SIDEBAR GAUCHE PROFILS ===== */
    #profileSidebar {
        position: fixed;
        top: 0;
        left: -250px;
        width: 250px;
        height: 100vh;
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(8px);
        border-right: 1px solid rgba(255, 255, 255, 0.08);
        padding: 20px 10px;
        transition: left 0.3s ease;
        z-index: 999;
        overflow-y: auto;
    }

    #profileSidebar.open {
        left: 0;
    }

    #toggleProfileSidebar {
        position: fixed;
        top: 20px;
        left: 20px;
        width: 45px;
        height: 45px;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1000;
        font-size: 22px;
        transition: all 0.3s ease;
        color: white;
    }

    #toggleProfileSidebar:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: scale(1.05);
    }

    .profile-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 10px;
    }

    .profile-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px;
        border-radius: 12px;
        transition: background 0.2s;
        cursor: pointer;
    }

    .profile-item:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .profile-photo {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.08);
        border: 2px solid rgba(255, 255, 255, 0.4);
        overflow: hidden;
        flex-shrink: 0;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
    }

    .profile-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .status-dot {
        position: absolute;
        bottom: -1px;
        right: -1px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 2px solid rgba(0, 0, 0, 0.3);
    }

    .status-dot.online {
        background: #4caf50;
        box-shadow: 0 0 8px #4caf50;
    }

    .status-dot.offline {
        background: #f44336;
    }

    .profile-name {
        color: white;
        font-weight: 600;
        font-size: 14px;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
    }

    #profileSidebar::-webkit-scrollbar {
        width: 6px;
    }

    #profileSidebar::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
    }

    #profileSidebar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 10px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .chat-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .theme-selector {
            width: 100%;
        }

        .floating-visio-btn {
            width: 60px;
            height: 60px;
            font-size: 28px;
            bottom: 20px;
            right: 20px;
        }

        .modal.minimized {
            width: 280px;
            height: 200px;
            bottom: 100px;
            right: 20px;
        }
    }
</style>

</head>
<body class="theme-futuriste">
    <!-- Toggle Sidebar Profils -->
    <div id="toggleProfileSidebar">ðŸ‘¥</div>


<!-- Sidebar Profils -->
<div id="profileSidebar">
    <div style="margin-bottom: 20px;">
        <div style="color: white; font-weight: 600; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.2);">ðŸ’¬ Conversations</div>
        <button id="createGroupBtn" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 12px; color: white; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">âž• CrÃ©er un groupe</button>
    </div>
    <div class="profile-list" id="profileList">
        <!-- Profils ajoutÃ©s par JS -->
    </div>
</div>

<!-- Particules -->
<div class="particles" id="particles"></div>

<!-- Conteneur principal -->
<div class="chat-container">
    <!-- Header -->
    <div class="chat-header">
        <div class="theme-selector">
            <span class="theme-label">ThÃ¨me :</span>
            <div class="theme-options">
                <div class="theme-btn" data-theme="zen" style="background: linear-gradient(135deg, #e0f7fa 0%, #80deea 100%);" title="Zen"></div>
                <div class="theme-btn" data-theme="plage" style="background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);" title="Plage"></div>
                <div class="theme-btn" data-theme="foret" style="background: linear-gradient(135deg, #134e5e 0%, #71b280 100%);" title="ForÃªt"></div>
                <div class="theme-btn active" data-theme="futuriste" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" title="Futuriste"></div>
                <div class="theme-btn" data-theme="bonbon" style="background: linear-gradient(135deg, #ffecd2 0%, #ff9a9e 100%);" title="Bonbon"></div>
                <div class="theme-btn" data-theme="bar" style="background: linear-gradient(135deg, #2c003e 0%, #8b008b 100%);" title="Bar"></div>
                <div class="theme-btn" data-theme="chasse" style="background: linear-gradient(135deg, #3e2723 0%, #795548 100%);" title="Chasse"></div>
                <div class="theme-btn" data-theme="aquarium" style="background: linear-gradient(135deg, #00416a 0%, #ffe000 100%);" title="Aquarium"></div>
                <div class="theme-btn-custom" title="Photo personnalisÃ©e">
                    ðŸ“·
                    <input type="file" id="customBgInput" accept="image/*">
                </div>
                
                <!-- PHOTO DE PROFIL UTILISATEUR -->
                <div class="user-profile-photo" id="userProfilePhoto" title="Mon profil">
                    ðŸ’¬
                </div>
            </div>
        </div>
    </div>

    <!-- Messages -->
    <div class="messages-area" id="messagesArea">
        <!-- Les messages apparaÃ®tront ici -->
    </div>

    <!-- Input -->
    <div class="input-area">
        <input type="text" class="message-input" id="messageInput" placeholder="Tapez votre message...">
        
        <input type="file" id="fileInput" accept="*/*" style="display:none;">
        <button class="attach-btn" id="attachFileBtn" title="Fichier">ðŸ“Ž</button>
        
        <input type="file" id="photoInput" accept="image/*" style="display:none;">
        <button class="attach-btn" id="attachPhotoBtn" title="Photo">ðŸ“·</button>
        
        <input type="file" id="videoInput" accept="video/*" style="display:none;">
        <button class="attach-btn" id="attachVideoBtn" title="VidÃ©o">ðŸŽ¥</button>
        
        <button class="send-btn" id="sendBtn">Envoyer ðŸš€</button>
    </div>
</div>

<!-- Bouton Visio flottant -->
<button class="floating-visio-btn" id="floatingVisioBtn" title="Lancer un appel visio">
    ðŸŽ¥
</button>

<!-- Modal Visio -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal">
        <div class="modal-header">
            <h2 class="modal-title">âœ¨ Appel Visio</h2>
            <div class="header-controls">
                <button class="minimize-btn" id="minimizeBtn" title="RÃ©duire">â”€</button>
                <button class="close-btn" id="closeModal">Ã—</button>
            </div>
        </div>
        
        <div class="modal-content">
            <div class="video-container">
                <div class="video-placeholder">
                    <div class="video-placeholder-icon">ðŸ“¹</div>
                    <div class="video-placeholder-text">La camÃ©ra s'activera ici</div>
                </div>
            </div>

            <div class="participants-section">
                <h3 class="section-title">ðŸ‘¥ Participants (1/10)</h3>
                <div class="participants-list" id="participantsList">
                    <div class="participant-item active">
                        <div class="participant-avatar" id="currentUserAvatar">ðŸ‘¤</div>
                        <span class="participant-name" id="currentUserName">Vous</span>
                        <span class="participant-status">En ligne</span>
                    </div>
                </div>
                
                <div class="invite-section">
                    <input type="text" class="invite-input" id="inviteInput" placeholder="Entrez un prÃ©nom pour inviter...">
                    <button class="invite-btn" id="inviteBtn">âž• Inviter</button>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn active" id="toggleMic">ðŸŽ¤ Micro ON</button>
                <button class="control-btn active" id="toggleCamera">ðŸ“¹ CamÃ©ra ON</button>
                <button class="control-btn" id="shareScreen">ðŸ”Š Partage d'Ã©cran</button>
                <button class="control-btn" id="hangupBtn" style="background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);">ðŸ“ž Raccrocher</button>
            </div>
        </div>

        <!-- Vue minimisÃ©e -->
        <div class="mini-video-view">
            <div class="mini-video-container">
                <div class="mini-video-icon">ðŸ“¹</div>
            </div>
            <div class="mini-controls">
                <button class="mini-control-btn active" id="miniMic" title="Micro">ðŸŽ¤</button>
                <button class="mini-control-btn active" id="miniCamera" title="CamÃ©ra">ðŸ“¹</button>
                <button class="mini-control-btn hangup" id="miniHangup" title="Raccrocher">ðŸ“ž</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ===== RÃ‰CUPÃ‰RATION DE LA PHOTO DE PROFIL DEPUIS LA PAGE DE CONNEXION =====
    let currentUserPhoto = null;
    let currentUserPrenom = localStorage.getItem('prenom') || 'Vous';
    
    // RÃ©cupÃ©rer la photo depuis localStorage
    const savedPhotoUrl = localStorage.getItem('userPhotoUrl') || localStorage.getItem('tempPhotoPreview');
    
    // Fonction pour afficher la photo de profil
    function displayUserPhoto() {
        const userPhotoElement = document.getElementById('userProfilePhoto');
        const currentUserAvatarElement = document.getElementById('currentUserAvatar');
        const currentUserNameElement = document.getElementById('currentUserName');
        
        // Mettre Ã  jour le nom
        if (currentUserNameElement) {
            currentUserNameElement.textContent = currentUserPrenom;
        }
        
        if (savedPhotoUrl) {
            // Afficher dans le header
            userPhotoElement.innerHTML = `<img src="${savedPhotoUrl}" alt="Profil">`;
            currentUserPhoto = savedPhotoUrl;
            
            // Afficher dans la modal visio
            if (currentUserAvatarElement) {
                currentUserAvatarElement.innerHTML = `<img src="${savedPhotoUrl}" alt="Profil">`;
            }
        } else {
            // Pas de photo, afficher l'emoji par dÃ©faut
            userPhotoElement.textContent = 'ðŸ’¬';
            if (currentUserAvatarElement) {
                currentUserAvatarElement.textContent = 'ðŸ‘¤';
            }
        }
    }
    
    // Appeler la fonction au chargement
    displayUserPhoto();

    // ===== SIDEBAR PROFILS =====
    const profileSidebar = document.getElementById('profileSidebar');
    const toggleProfileBtn = document.getElementById('toggleProfileSidebar');

    toggleProfileBtn.addEventListener('click', () => {
        profileSidebar.classList.toggle('open');
    });

    // Profils chargÃ©s depuis Supabase
    const profiles = [];

    function renderProfiles() {
        const container = document.getElementById('profileList');
        container.innerHTML = '';
        
        profiles.forEach(profile => {
            const item = document.createElement('div');
            item.className = 'profile-item';
            item.onclick = () => openPrivateConversation(profile.name);
            
            const photoDiv = document.createElement('div');
            photoDiv.className = 'profile-photo';
            
            if (profile.photo) {
                const img = document.createElement('img');
                img.src = profile.photo;
                img.alt = profile.name;
                photoDiv.appendChild(img);
            } else {
                photoDiv.textContent = profile.emoji || profile.name[0].toUpperCase();
            }
            
            const statusDot = document.createElement('div');
            statusDot.className = 'status-dot ' + (profile.online ? 'online' : 'offline');
            photoDiv.appendChild(statusDot);
            
            const nameSpan = document.createElement('span');
            nameSpan.className = 'profile-name';
            nameSpan.textContent = profile.name;
            
            item.appendChild(photoDiv);
            item.appendChild(nameSpan);
            container.appendChild(item);
        });
    }

    // Fonction pour ouvrir conversation privÃ©e
    function openPrivateConversation(username) {
        // Fermer la sidebar
        profileSidebar.classList.remove('open');
        
        // TODO: ImplÃ©menter la logique de conversation privÃ©e
        console.log('Conversation privÃ©e avec:', username);
        alert(`ðŸš§ Conversation privÃ©e avec ${username} - En dÃ©veloppement`);
    }

    // Bouton crÃ©er groupe
    document.getElementById('createGroupBtn')?.addEventListener('click', () => {
        alert('ðŸš§ FonctionnalitÃ© "CrÃ©er un groupe" en dÃ©veloppement !');
    });

    // Afficher les profils
    renderProfiles();

    // ===== BOUTONS ATTACHEMENTS =====
    document.getElementById('attachFileBtn').addEventListener('click', () => {
        document.getElementById('fileInput').click();
    });

    document.getElementById('attachPhotoBtn').addEventListener('click', () => {
        document.getElementById('photoInput').click();
    });

    document.getElementById('attachVideoBtn').addEventListener('click', () => {
        document.getElementById('videoInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            console.log('ðŸ“Ž Fichier sÃ©lectionnÃ©:', file.name);
        }
    });

    document.getElementById('photoInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            console.log('ðŸ“· Photo sÃ©lectionnÃ©e:', file.name);
        }
    });

    document.getElementById('videoInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            console.log('ðŸŽ¥ VidÃ©o sÃ©lectionnÃ©e:', file.name);
        }
    });

    // ===== CODE ORIGINAL =====
    // Particules
    function createParticles() {
        const container = document.getElementById('particles');
        for (let i = 0; i < 40; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 20 + 's';
            particle.style.animationDuration = (Math.random() * 15 + 15) + 's';
            container.appendChild(particle);
        }
    }

    // ThÃ¨mes
    document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // Retirer toutes les classes
            document.body.className = '';
            document.body.style.backgroundImage = '';
            
            // Retirer l'Ã©tat actif
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            
            // Ajouter le nouveau thÃ¨me
            btn.classList.add('active');
            document.body.classList.add('theme-' + btn.dataset.theme);
        });
    });

    // Image personnalisÃ©e
    document.getElementById('customBgInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                document.body.className = 'custom-bg';
                document.body.style.backgroundImage = 'url(' + event.target.result + ')';
                document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            };
            reader.readAsDataURL(file);
        }
    });

    // Messages - MODIFIÃ‰ POUR INCLURE LA PHOTO
    function addMessage(author, text) {
        const container = document.getElementById('messagesArea');
        const time = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        const msg = document.createElement('div');
        msg.className = 'message';
        
        // CrÃ©er l'avatar avec photo si disponible
        let avatarHTML = '<div class="message-avatar">';
        if (author === 'Vous' && currentUserPhoto) {
            avatarHTML += `<img src="${currentUserPhoto}" alt="${author}">`;
        } else {
            avatarHTML += 'ðŸ‘¤';
        }
        avatarHTML += '</div>';
        
        msg.innerHTML = avatarHTML +
                      '<div class="message-content">' +
                      '<div class="message-author">' + author + '</div>' +
                      '<div class="message-text">' + text + '</div>' +
                      '<div class="message-time">' + time + '</div>' +
                      '</div>';
        container.appendChild(msg);
        container.scrollTop = container.scrollHeight;
    }

    function sendMessage() {
        const input = document.getElementById('messageInput');
        if (input.value.trim()) {
            addMessage('Vous', input.value.trim());
            input.value = '';
        }
    }

    document.getElementById('sendBtn').addEventListener('click', sendMessage);
    document.getElementById('messageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') sendMessage();
    });

    // Participants
    const participants = [{ name: currentUserPrenom, status: 'En ligne', avatar: 'ðŸ‘¤', isYou: true, photo: currentUserPhoto }];

    function updateParticipantsList() {
        let html = '';
        participants.forEach(function(p) {
            let avatarContent = '';
            if (p.photo) {
                avatarContent = `<img src="${p.photo}" alt="${p.name}">`;
            } else {
                avatarContent = p.avatar;
            }
            
            html += '<div class="participant-item ' + (p.isYou ? 'active' : '') + '">' +
                   '<div class="participant-avatar">' + avatarContent + '</div>' +
                   '<span class="participant-name">' + p.name + '</span>' +
                   '<span class="participant-status">' + p.status + '</span>' +
                   '</div>';
        });
        document.getElementById('participantsList').innerHTML = html;
        document.querySelector('.participants-section h3').textContent = 'ðŸ‘¥ Participants (' + participants.length + '/10)';
    }

    document.getElementById('inviteBtn').addEventListener('click', function() {
        const input = document.getElementById('inviteInput');
        const prenom = input.value.trim();
        if (prenom && participants.length < 10) {
            let exists = false;
            participants.forEach(function(p) {
                if (p.name.toLowerCase() === prenom.toLowerCase()) exists = true;
            });
            if (exists) {
                alert('Cette personne est dÃ©jÃ  dans l\'appel !');
                return;
            }
            const avatars = ['ðŸ‘¨', 'ðŸ‘©', 'ðŸ§‘', 'ðŸ‘¦', 'ðŸ‘§', 'ðŸ§”', 'ðŸ‘´', 'ðŸ‘µ'];
            participants.push({
                name: prenom,
                status: 'Connexion...',
                avatar: avatars[Math.floor(Math.random() * avatars.length)],
                isYou: false,
                photo: null
            });
            updateParticipantsList();
            input.value = '';
            setTimeout(function() {
                participants[participants.length - 1].status = 'En ligne';
                updateParticipantsList();
            }, 2000);
        } else if (participants.length >= 10) {
            alert('Nombre maximum de participants atteint (10)');
        }
    });

    document.getElementById('inviteInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') document.getElementById('inviteBtn').click();
    });

    // Visio
    document.getElementById('floatingVisioBtn').addEventListener('click', function() {
        document.getElementById('modalOverlay').classList.add('active');
    });

    document.getElementById('closeModal').addEventListener('click', function() {
        document.getElementById('modalOverlay').classList.remove('active');
    });

    document.getElementById('hangupBtn').addEventListener('click', function() {
        document.getElementById('modalOverlay').classList.remove('active');
    });

    document.getElementById('modalOverlay').addEventListener('click', function(e) {
        if (e.target === document.getElementById('modalOverlay')) {
            document.getElementById('modalOverlay').classList.remove('active');
        }
    });

    // Minimisation
    let isMinimized = false;
    document.getElementById('minimizeBtn').addEventListener('click', function() {
        isMinimized = !isMinimized;
        const modal = document.getElementById('modal');
        const overlay = document.getElementById('modalOverlay');
        if (isMinimized) {
            modal.classList.add('minimized');
            overlay.classList.add('minimized');
            document.getElementById('minimizeBtn').textContent = 'â–¡';
        } else {
            modal.classList.remove('minimized');
            overlay.classList.remove('minimized');
            document.getElementById('minimizeBtn').textContent = 'â”€';
        }
    });

    // DÃ©placement
    let isDragging = false;
    let currentX, currentY, initialX, initialY;
    let xOffset = 0, yOffset = 0;
    const modal = document.getElementById('modal');

    modal.addEventListener('mousedown', dragStart);
    modal.addEventListener('touchstart', dragStart);
    document.addEventListener('mousemove', drag);
    document.addEventListener('touchmove', drag);
    document.addEventListener('mouseup', dragEnd);
    document.addEventListener('touchend', dragEnd);

    function dragStart(e) {
        if (!modal.classList.contains('minimized')) return;
        if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') return;
        if (e.type === 'touchstart') {
            initialX = e.touches[0].clientX - xOffset;
            initialY = e.touches[0].clientY - yOffset;
        } else {
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
        }
        isDragging = true;
    }

    function drag(e) {
        if (!isDragging) return;
        e.preventDefault();
        if (e.type === 'touchmove') {
            currentX = e.touches[0].clientX - initialX;
            currentY = e.touches[0].clientY - initialY;
        } else {
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;
        }
        xOffset = currentX;
        yOffset = currentY;
        modal.style.transform = 'translate(' + currentX + 'px, ' + currentY + 'px)';
    }

    function dragEnd() {
        initialX = currentX;
        initialY = currentY;
        isDragging = false;
    }

    // ContrÃ´les
    let micOn = true, cameraOn = true, screenSharing = false;

    document.getElementById('toggleMic').addEventListener('click', function() {
        micOn = !micOn;
        this.classList.toggle('active');
        this.textContent = micOn ? 'ðŸŽ¤ Micro ON' : 'ðŸ”‡ Micro OFF';
    });

    document.getElementById('toggleCamera').addEventListener('click', function() {
        cameraOn = !cameraOn;
        this.classList.toggle('active');
        this.textContent = cameraOn ? 'ðŸ“¹ CamÃ©ra ON' : 'ðŸ“¹ CamÃ©ra OFF';
    });

    document.getElementById('shareScreen').addEventListener('click', function() {
        screenSharing = !screenSharing;
        this.classList.toggle('active');
        this.textContent = screenSharing ? 'ðŸ”´ ArrÃªter partage' : 'ðŸ”Š Partage d\'Ã©cran';
    });

    // Mini contrÃ´les
    document.getElementById('miniMic').addEventListener('click', function() {
        micOn = !micOn;
        this.classList.toggle('active');
        document.getElementById('toggleMic').classList.toggle('active');
        document.getElementById('toggleMic').textContent = micOn ? 'ðŸŽ¤ Micro ON' : 'ðŸ”‡ Micro OFF';
    });

    document.getElementById('miniCamera').addEventListener('click', function() {
        cameraOn = !cameraOn;
        this.classList.toggle('active');
        document.getElementById('toggleCamera').classList.toggle('active');
        document.getElementById('toggleCamera').textContent = cameraOn ? 'ðŸ“¹ CamÃ©ra ON' : 'ðŸ“¹ CamÃ©ra OFF';
    });

    document.getElementById('miniHangup').addEventListener('click', function() {
        document.getElementById('modalOverlay').classList.remove('active');
        modal.classList.remove('minimized');
        document.getElementById('modalOverlay').classList.remove('minimized');
    });

    // Init
    createParticles();
</script>

</body>
</html>
