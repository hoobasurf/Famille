<!DOCTYPE html>

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mur â€” BubbleChat</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            min-height: 100vh; 
            padding: 20px;
            overflow-x: hidden;
        }

```
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* HEADER */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .header {
        background: rgba(255,255,255,.05);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px 30px;
        margin-bottom: 30px;
        border: 1px solid rgba(255,255,255,.15);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }
    .header-title {
        color: white;
        font-size: 28px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .header-actions {
        display: flex;
        gap: 12px;
        align-items: center;
    }
    .btn {
        padding: 12px 24px;
        border-radius: 12px;
        border: none;
        font-weight: 700;
        cursor: pointer;
        transition: all .3s;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .btn-primary {
        background: linear-gradient(135deg, #ff6b9d, #c06fff);
        color: white;
        box-shadow: 0 4px 15px rgba(192,111,255,.4);
    }
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(192,111,255,.6);
    }
    .btn-secondary {
        background: rgba(255,255,255,.1);
        color: white;
        border: 2px solid rgba(255,255,255,.2);
    }
    .btn-secondary:hover {
        background: rgba(255,255,255,.2);
        transform: translateY(-2px);
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* TABS (MUR GÃ‰NÃ‰RAL / MES AMIS) */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .tabs {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }
    .tab {
        padding: 14px 28px;
        background: rgba(255,255,255,.08);
        border: 2px solid rgba(255,255,255,.15);
        border-radius: 14px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all .3s;
        font-size: 15px;
    }
    .tab:hover {
        background: rgba(255,255,255,.15);
        transform: translateY(-2px);
    }
    .tab.active {
        background: linear-gradient(135deg, rgba(255,107,157,.3), rgba(192,111,255,.3));
        border-color: rgba(255,107,157,.6);
        box-shadow: 0 0 20px rgba(255,107,157,.4);
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* GRILLE DE PROFILS STYLE NETFLIX */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .profiles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
    }
    .profile-card {
        background: rgba(255,255,255,.05);
        backdrop-filter: blur(10px);
        border-radius: 18px;
        padding: 20px;
        border: 3px solid transparent;
        cursor: pointer;
        transition: all .4s cubic-bezier(.34,1.56,.64,1);
        position: relative;
        overflow: hidden;
    }
    .profile-card:hover {
        transform: translateY(-8px) scale(1.02);
        border-color: rgba(255,107,157,.8);
        box-shadow: 0 0 30px rgba(255,107,157,.6), 0 10px 40px rgba(0,0,0,.4);
    }
    .profile-card::before {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 18px;
        padding: 3px;
        background: linear-gradient(135deg, #ff6b9d, #c06fff, #64b5f6);
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        opacity: 0;
        transition: opacity .4s;
    }
    .profile-card:hover::before {
        opacity: 1;
        animation: neonPulse 2s ease-in-out infinite;
    }
    @keyframes neonPulse {
        0%, 100% { opacity: .6; }
        50% { opacity: 1; }
    }
    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin: 0 auto 16px;
        background: linear-gradient(135deg, #ff6b9d, #c06fff);
        border: 4px solid rgba(255,255,255,.3);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        color: white;
        font-weight: 700;
        position: relative;
    }
    .profile-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .status-indicator {
        position: absolute;
        bottom: 5px;
        right: 5px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 3px solid rgba(255,255,255,.9);
    }
    .status-indicator.online {
        background: #4caf50;
        animation: pulse 2s infinite;
    }
    .status-indicator.offline {
        background: #999;
    }
    @keyframes pulse {
        0%, 100% { box-shadow: 0 0 8px #4caf50; }
        50% { box-shadow: 0 0 18px #4caf50; }
    }
    .profile-name {
        color: white;
        font-weight: 700;
        font-size: 18px;
        text-align: center;
        margin-bottom: 8px;
    }
    .profile-posts-count {
        color: rgba(255,255,255,.6);
        font-size: 14px;
        text-align: center;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* MODALE MUR D'UN UTILISATEUR */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.85);
        backdrop-filter: blur(8px);
        z-index: 9999;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
        animation: fadeIn .3s;
    }
    .modal-overlay.open {
        display: flex;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    .modal {
        background: rgba(20,20,30,.98);
        border-radius: 24px;
        width: 100%;
        max-width: 700px;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        border: 2px solid rgba(255,107,157,.3);
        box-shadow: 0 25px 80px rgba(0,0,0,.8);
        animation: slideUp .4s cubic-bezier(.34,1.56,.64,1);
    }
    @keyframes slideUp {
        from { opacity: 0; transform: translateY(50px) scale(.9); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }
    .modal-header {
        padding: 24px 28px;
        border-bottom: 2px solid rgba(255,255,255,.1);
        display: flex;
        align-items: center;
        gap: 18px;
        flex-shrink: 0;
    }
    .modal-header-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6b9d, #c06fff);
        overflow: hidden;
        border: 3px solid rgba(255,255,255,.3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        color: white;
        font-weight: 700;
    }
    .modal-header-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .modal-header-info {
        flex: 1;
    }
    .modal-header-name {
        color: white;
        font-weight: 700;
        font-size: 22px;
        margin-bottom: 4px;
    }
    .modal-header-status {
        color: rgba(255,255,255,.6);
        font-size: 14px;
    }
    .modal-close {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255,255,255,.1);
        border: 2px solid rgba(255,255,255,.2);
        color: white;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .3s;
    }
    .modal-close:hover {
        background: rgba(255,255,255,.2);
        transform: rotate(90deg);
    }
    .modal-content {
        flex: 1;
        overflow-y: auto;
        padding: 24px 28px;
    }
    .modal-content::-webkit-scrollbar {
        width: 8px;
    }
    .modal-content::-webkit-scrollbar-track {
        background: rgba(255,255,255,.05);
        border-radius: 10px;
    }
    .modal-content::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #ff6b9d, #c06fff);
        border-radius: 10px;
    }
    .modal-footer {
        padding: 20px 28px;
        border-top: 2px solid rgba(255,255,255,.1);
        display: flex;
        gap: 12px;
        flex-shrink: 0;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* POSTS STYLE FACEBOOK */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .post-composer {
        background: rgba(255,255,255,.05);
        backdrop-filter: blur(10px);
        border-radius: 18px;
        padding: 20px 24px;
        margin-bottom: 24px;
        border: 2px solid rgba(255,255,255,.15);
    }
    .post-composer-input {
        width: 100%;
        background: rgba(255,255,255,.08);
        border: 2px solid rgba(255,255,255,.15);
        border-radius: 14px;
        padding: 14px 18px;
        color: white;
        font-size: 15px;
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
        margin-bottom: 12px;
    }
    .post-composer-input:focus {
        outline: none;
        background: rgba(255,255,255,.12);
        border-color: rgba(255,107,157,.5);
    }
    .post-composer-input::placeholder {
        color: rgba(255,255,255,.5);
    }
    .post-composer-actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .post-composer-attach {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255,255,255,.1);
        border: 2px solid rgba(255,255,255,.15);
        color: white;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .3s;
        position: relative;
    }
    .post-composer-attach:hover {
        background: rgba(255,255,255,.2);
        transform: scale(1.1);
    }
    .post-composer-attach input[type=file] {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }
    
    .post {
        background: rgba(255,255,255,.05);
        backdrop-filter: blur(10px);
        border-radius: 18px;
        padding: 20px 24px;
        margin-bottom: 20px;
        border: 2px solid rgba(255,255,255,.1);
        animation: slideIn .4s;
    }
    @keyframes slideIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .post-header {
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 16px;
    }
    .post-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6b9d, #c06fff);
        overflow: hidden;
        border: 3px solid rgba(255,255,255,.3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
        font-weight: 700;
    }
    .post-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .post-author-info {
        flex: 1;
    }
    .post-author-name {
        color: white;
        font-weight: 700;
        font-size: 16px;
    }
    .post-time {
        color: rgba(255,255,255,.5);
        font-size: 13px;
        margin-top: 2px;
    }
    .post-content {
        color: white;
        font-size: 15px;
        line-height: 1.6;
        margin-bottom: 14px;
        white-space: pre-wrap;
    }
    .post-image {
        width: 100%;
        border-radius: 12px;
        margin-bottom: 14px;
    }
    .post-actions {
        display: flex;
        gap: 20px;
        padding-top: 12px;
        border-top: 1px solid rgba(255,255,255,.1);
    }
    .post-action {
        display: flex;
        align-items: center;
        gap: 8px;
        color: rgba(255,255,255,.7);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all .3s;
        padding: 8px 14px;
        border-radius: 10px;
    }
    .post-action:hover {
        background: rgba(255,255,255,.1);
        color: white;
    }
    .post-action.liked {
        color: #ff6b9d;
    }
    .post-action-icon {
        font-size: 18px;
    }
    
    .comments-section {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid rgba(255,255,255,.1);
    }
    .comment {
        display: flex;
        gap: 12px;
        margin-bottom: 14px;
    }
    .comment-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6b9d, #c06fff);
        overflow: hidden;
        border: 2px solid rgba(255,255,255,.3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        color: white;
        font-weight: 700;
        flex-shrink: 0;
    }
    .comment-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .comment-content {
        flex: 1;
        background: rgba(255,255,255,.08);
        border-radius: 12px;
        padding: 10px 14px;
    }
    .comment-author {
        color: white;
        font-weight: 700;
        font-size: 14px;
        margin-bottom: 4px;
    }
    .comment-text {
        color: rgba(255,255,255,.9);
        font-size: 14px;
        line-height: 1.5;
    }
    .comment-time {
        color: rgba(255,255,255,.4);
        font-size: 12px;
        margin-top: 4px;
    }
    
    .comment-composer {
        display: flex;
        gap: 12px;
        margin-top: 12px;
    }
    .comment-input {
        flex: 1;
        background: rgba(255,255,255,.08);
        border: 2px solid rgba(255,255,255,.15);
        border-radius: 20px;
        padding: 10px 18px;
        color: white;
        font-size: 14px;
    }
    .comment-input:focus {
        outline: none;
        background: rgba(255,255,255,.12);
        border-color: rgba(255,107,157,.5);
    }
    .comment-input::placeholder {
        color: rgba(255,255,255,.5);
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: rgba(255,255,255,.5);
    }
    .empty-state-icon {
        font-size: 64px;
        margin-bottom: 16px;
    }
    .empty-state-text {
        font-size: 16px;
        line-height: 1.6;
    }
    
    @media (max-width: 768px) {
        body { padding: 10px; }
        .header { padding: 16px 20px; }
        .header-title { font-size: 22px; }
        .profiles-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 16px; }
        .profile-avatar { width: 90px; height: 90px; font-size: 36px; }
        .modal { max-width: 100%; border-radius: 20px 20px 0 0; max-height: 85vh; }
        .modal-header, .modal-content, .modal-footer { padding: 16px 20px; }
        .btn { padding: 10px 18px; font-size: 13px; }
    }
</style>
```

</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="header-title">
            ğŸ“° Mur
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="window.location.href='chat.html'">
                ğŸ’¬ Chat
            </button>
            <button class="btn btn-secondary" onclick="window.location.href='arcade.html'">
                ğŸ•¹ï¸ Arcade
            </button>
        </div>
    </div>

```
<!-- TABS -->
<div class="tabs">
    <div class="tab active" id="tabPublic">ğŸŒ Mur gÃ©nÃ©ral</div>
    <div class="tab" id="tabFriends">ğŸ‘¥ Mes amis</div>
</div>

<!-- GRILLE DE PROFILS -->
<div class="profiles-grid" id="profilesGrid"></div>

<!-- MODALE MUR UTILISATEUR -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-header-avatar" id="modalAvatar">ğŸ’¬</div>
            <div class="modal-header-info">
                <div class="modal-header-name" id="modalName">Utilisateur</div>
                <div class="modal-header-status" id="modalStatus">Profil</div>
            </div>
            <div class="modal-close" onclick="closeModal()">Ã—</div>
        </div>
        <div class="modal-content" id="modalContent">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“</div>
                <div class="empty-state-text">Aucune publication</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" style="flex:1" onclick="goToChat()">
                ğŸ’¬ Envoyer un message
            </button>
            <button class="btn btn-secondary" onclick="closeModal()">
                Fermer
            </button>
        </div>
    </div>
</div>

<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    
    const supabase = createClient(
        'https://eeikriwrwuynwpzodbbt.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVlaWtyaXdyd3V5bndwem9kYmJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NzQ3NjYsImV4cCI6MjA4NjE1MDc2Nn0.MJ6CSmrttEWcrdfy5C7nP4sE_pe19sGNE-WasASPDNc'
    );
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VARIABLES GLOBALES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let currentUserPrenom = localStorage.getItem('prenom') || 'InvitÃ©';
    let currentUserPhoto = localStorage.getItem('userPhotoUrl') || localStorage.getItem('tempPhotoPreview');
    let fingerprint = localStorage.getItem('browserFingerprint');
    if (!fingerprint) {
        fingerprint = Math.random().toString(36).slice(2) + Date.now().toString(36);
        localStorage.setItem('browserFingerprint', fingerprint);
    }
    let currentUniqueId = currentUserPrenom + '_' + fingerprint;
    let currentView = 'public'; // 'public' ou 'friends'
    let currentModalUser = null;
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TABS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.getElementById('tabPublic').addEventListener('click', function() {
        currentView = 'public';
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        loadProfiles();
    });
    
    document.getElementById('tabFriends').addEventListener('click', function() {
        currentView = 'friends';
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        loadProfiles();
    });
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHARGER LES PROFILS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadProfiles() {
        const grid = document.getElementById('profilesGrid');
        grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">â³</div><div class="empty-state-text">Chargement...</div></div>';
        
        try {
            // Charger tous les profils
            const { data: profiles, error } = await supabase
                .from('profiles')
                .select('unique_id, prenom, photo_url, is_online')
                .neq('unique_id', currentUniqueId)
                .order('is_online', { ascending: false })
                .order('prenom', { ascending: true });
            
            if (error) throw error;
            
            // Compter les posts pour chaque profil
            const profilesWithCounts = await Promise.all(profiles.map(async (profile) => {
                const { count } = await supabase
                    .from('wall_posts')
                    .select('id', { count: 'exact', head: true })
                    .eq('author_id', profile.unique_id)
                    .eq('is_public', currentView === 'public');
                
                return { ...profile, postCount: count || 0 };
            }));
            
            grid.innerHTML = '';
            
            if (profilesWithCounts.length === 0) {
                grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘¥</div><div class="empty-state-text">Aucun utilisateur trouvÃ©</div></div>';
                return;
            }
            
            // Afficher les profils
            profilesWithCounts.forEach(profile => {
                const card = document.createElement('div');
                card.className = 'profile-card';
                card.onclick = () => openModal(profile);
                
                const avatarContent = profile.photo_url 
                    ? `<img src="${esc(profile.photo_url)}" alt="${esc(profile.prenom)}">`
                    : profile.prenom[0].toUpperCase();
                
                card.innerHTML = `
                    <div class="profile-avatar">
                        ${avatarContent}
                        <div class="status-indicator ${profile.is_online ? 'online' : 'offline'}"></div>
                    </div>
                    <div class="profile-name">${esc(profile.prenom)}</div>
                    <div class="profile-posts-count">
                        ${profile.postCount} publication${profile.postCount > 1 ? 's' : ''}
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
        } catch (error) {
            console.error('Erreur chargement profils:', error);
            grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><div class="empty-state-text">Erreur de chargement</div></div>';
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MODAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function openModal(user) {
        currentModalUser = user;
        const overlay = document.getElementById('modalOverlay');
        const modalAvatar = document.getElementById('modalAvatar');
        const modalName = document.getElementById('modalName');
        const modalStatus = document.getElementById('modalStatus');
        const modalContent = document.getElementById('modalContent');
        
        // Header
        const avatarContent = user.photo_url 
            ? `<img src="${esc(user.photo_url)}" alt="${esc(user.prenom)}">`
            : user.prenom[0].toUpperCase();
        modalAvatar.innerHTML = avatarContent;
        modalName.textContent = user.prenom;
        modalStatus.textContent = currentView === 'public' ? 'Mur public' : 'Mur personnel';
        
        // Composer (uniquement sur le mur public)
        let composerHTML = '';
        if (currentView === 'public') {
            composerHTML = `
                <div class="post-composer">
                    <textarea 
                        class="post-composer-input" 
                        id="postInput"
                        placeholder="Quoi de neuf, ${currentUserPrenom} ?"></textarea>
                    <div class="post-composer-actions">
                        <div class="post-composer-attach">
                            ğŸ“·
                            <input type="file" id="postImageInput" accept="image/*">
                        </div>
                        <button class="btn btn-primary" onclick="window.publishPost()" style="flex:1">
                            ğŸ“¤ Publier
                        </button>
                    </div>
                </div>
            `;
        }
        
        modalContent.innerHTML = composerHTML + '<div id="postsContainer"><div class="empty-state"><div class="empty-state-icon">â³</div><div class="empty-state-text">Chargement...</div></div></div>';
        
        overlay.classList.add('open');
        document.body.style.overflow = 'hidden';
        
        // Charger les posts
        await loadPosts(user.unique_id);
    }
    
    window.closeModal = function() {
        document.getElementById('modalOverlay').classList.remove('open');
        document.body.style.overflow = '';
        currentModalUser = null;
    };
    
    window.goToChat = function() {
        if (!currentModalUser) return;
        localStorage.setItem('openPrivateChat', currentModalUser.unique_id);
        window.location.href = 'chat.html';
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHARGER LES POSTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadPosts(authorId) {
        const container = document.getElementById('postsContainer');
        
        try {
            const { data: posts, error } = await supabase
                .from('wall_posts')
                .select(`
                    *,
                    wall_comments(*, count),
                    wall_likes(*, count)
                `)
                .eq('author_id', authorId)
                .eq('is_public', currentView === 'public')
                .order('created_at', { ascending: false });
            
            if (error) throw error;
            
            if (!posts || posts.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><div class="empty-state-text">Aucune publication</div></div>';
                return;
            }
            
            container.innerHTML = '';
            
            for (const post of posts) {
                const postEl = await renderPost(post);
                container.appendChild(postEl);
            }
            
        } catch (error) {
            console.error('Erreur chargement posts:', error);
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><div class="empty-state-text">Erreur de chargement</div></div>';
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER POST
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function renderPost(post) {
        const postEl = document.createElement('div');
        postEl.className = 'post';
        postEl.dataset.postId = post.id;
        
        const avatarContent = post.author_photo 
            ? `<img src="${esc(post.author_photo)}" alt="${esc(post.author_name)}">`
            : post.author_name[0].toUpperCase();
        
        const imageHTML = post.image_url 
            ? `<img src="${esc(post.image_url)}" alt="Image" class="post-image">`
            : '';
        
        const likesCount = post.wall_likes?.length || 0;
        const commentsCount = post.wall_comments?.length || 0;
        const isLiked = post.wall_likes?.some(like => like.user_id === currentUniqueId) || false;
        
        postEl.innerHTML = `
            <div class="post-header">
                <div class="post-avatar">${avatarContent}</div>
                <div class="post-author-info">
                    <div class="post-author-name">${esc(post.author_name)}</div>
                    <div class="post-time">${formatTime(post.created_at)}</div>
                </div>
            </div>
            <div class="post-content">${esc(post.content)}</div>
            ${imageHTML}
            <div class="post-actions">
                <div class="post-action ${isLiked ? 'liked' : ''}" onclick="window.toggleLike(${post.id})">
                    <span class="post-action-icon">${isLiked ? 'â¤ï¸' : 'ğŸ¤'}</span>
                    <span id="likesCount-${post.id}">${likesCount}</span>
                </div>
                <div class="post-action" onclick="window.toggleComments(${post.id})">
                    <span class="post-action-icon">ğŸ’¬</span>
                    <span id="commentsCount-${post.id}">${commentsCount}</span>
                </div>
            </div>
            <div class="comments-section" id="comments-${post.id}" style="display:none;">
                <div id="commentsList-${post.id}"></div>
                <div class="comment-composer">
                    <input 
                        type="text" 
                        class="comment-input" 
                        id="commentInput-${post.id}"
                        placeholder="Ajouter un commentaire..."
                        onkeypress="if(event.key==='Enter') window.postComment(${post.id})">
                </div>
            </div>
        `;
        
        return postEl;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PUBLIER UN POST
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    window.publishPost = async function() {
        const input = document.getElementById('postInput');
        const content = input.value.trim();
        const imageInput = document.getElementById('postImageInput');
        
        if (!content) {
            alert('Ã‰crivez quelque chose !');
            return;
        }
        
        try {
            let imageUrl = null;
            
            // Upload image si prÃ©sente
            if (imageInput.files && imageInput.files[0]) {
                const file = imageInput.files[0];
                const fileName = Date.now() + '_' + file.name.replace(/[^a-zA-Z0-9._-]/g, '');
                
                const { data, error } = await supabase.storage
                    .from('chat-files')
                    .upload(fileName, file);
                
                if (!error) {
                    const { data: urlData } = supabase.storage
                        .from('chat-files')
                        .getPublicUrl(fileName);
                    imageUrl = urlData.publicUrl;
                }
            }
            
            // CrÃ©er le post
            const { error } = await supabase
                .from('wall_posts')
                .insert({
                    author_id: currentUniqueId,
                    author_name: currentUserPrenom,
                    author_photo: currentUserPhoto,
                    content: content,
                    image_url: imageUrl,
                    is_public: true
                });
            
            if (error) throw error;
            
            input.value = '';
            imageInput.value = '';
            
            // Recharger les posts
            await loadPosts(currentModalUser.unique_id);
            
        } catch (error) {
            console.error('Erreur publication:', error);
            alert('Erreur lors de la publication');
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TOGGLE LIKE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    window.toggleLike = async function(postId) {
        try {
            // VÃ©rifier si dÃ©jÃ  likÃ©
            const { data: existing } = await supabase
                .from('wall_likes')
                .select('id')
                .eq('post_id', postId)
                .eq('user_id', currentUniqueId)
                .single();
            
            if (existing) {
                // Unlike
                await supabase
                    .from('wall_likes')
                    .delete()
                    .eq('id', existing.id);
            } else {
                // Like
                await supabase
                    .from('wall_likes')
                    .insert({
                        post_id: postId,
                        user_id: currentUniqueId,
                        user_name: currentUserPrenom
                    });
            }
            
            // Recharger le post
            await loadPosts(currentModalUser.unique_id);
            
        } catch (error) {
            console.error('Erreur like:', error);
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TOGGLE COMMENTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    window.toggleComments = async function(postId) {
        const commentsSection = document.getElementById('comments-' + postId);
        const isVisible = commentsSection.style.display !== 'none';
        
        if (isVisible) {
            commentsSection.style.display = 'none';
        } else {
            commentsSection.style.display = 'block';
            await loadComments(postId);
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHARGER LES COMMENTAIRES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadComments(postId) {
        const container = document.getElementById('commentsList-' + postId);
        
        try {
            const { data: comments, error } = await supabase
                .from('wall_comments')
                .select('*')
                .eq('post_id', postId)
                .order('created_at', { ascending: true });
            
            if (error) throw error;
            
            container.innerHTML = '';
            
            if (!comments || comments.length === 0) {
                return;
            }
            
            comments.forEach(comment => {
                const commentEl = document.createElement('div');
                commentEl.className = 'comment';
                
                const avatarContent = comment.author_photo 
                    ? `<img src="${esc(comment.author_photo)}" alt="${esc(comment.author_name)}">`
                    : comment.author_name[0].toUpperCase();
                
                commentEl.innerHTML = `
                    <div class="comment-avatar">${avatarContent}</div>
                    <div class="comment-content">
                        <div class="comment-author">${esc(comment.author_name)}</div>
                        <div class="comment-text">${esc(comment.content)}</div>
                        <div class="comment-time">${formatTime(comment.created_at)}</div>
                    </div>
                `;
                
                container.appendChild(commentEl);
            });
            
        } catch (error) {
            console.error('Erreur chargement commentaires:', error);
        }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // POSTER UN COMMENTAIRE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    window.postComment = async function(postId) {
        const input = document.getElementById('commentInput-' + postId);
        const content = input.value.trim();
        
        if (!content) return;
        
        try {
            const { error } = await supabase
                .from('wall_comments')
                .insert({
                    post_id: postId,
                    author_id: currentUniqueId,
                    author_name: currentUserPrenom,
                    author_photo: currentUserPhoto,
                    content: content
                });
            
            if (error) throw error;
            
            input.value = '';
            
            // Recharger les commentaires
            await loadComments(postId);
            
            // Mettre Ã  jour le compteur
            const countEl = document.getElementById('commentsCount-' + postId);
            if (countEl) {
                countEl.textContent = parseInt(countEl.textContent) + 1;
            }
            
        } catch (error) {
            console.error('Erreur commentaire:', error);
        }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function esc(str) {
        return String(str || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }
    
    function formatTime(iso) {
        if (!iso) return '';
        const d = new Date(iso);
        const now = new Date();
        const diff = now - d;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);
        
        if (minutes < 1) return 'Ã€ l\'instant';
        if (minutes < 60) return minutes + ' min';
        if (hours < 24) return hours + ' h';
        if (days < 7) return days + ' j';
        
        return d.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    loadProfiles();
    
    // Fermer modal si clic en dehors
    document.getElementById('modalOverlay').addEventListener('click', function(e) {
        if (e.target === this) {
            window.closeModal();
        }
    });
    
    // Touche Escape pour fermer
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            window.closeModal();
        }
    });
</script>
```

</body>
</html>
